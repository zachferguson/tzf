<!doctype html>
<html class="no-js" lang="">
<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>Weather & Forecast</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
	div{
		border: 1px solid red;
	}
*{
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}
html{
	min-height: 100%
}
body{
	min-height: 100%;
	height: auto;
	background-color: green;
}
#page-wrapper{
	max-width: 1366px;
	min-height: 100vh;
	height: auto;
	display: grid;
	grid-template-areas:
		'header'
		'navbtns'
		'ctrlbtns'
		'content'
		'footer';
	grid-template-rows: auto auto auto 1fr 1em;
	grid-template-columns: 1fr;

}
#header{
	grid-area: header;
}
#navbuttons{
	grid-area: navbtns;
	display: flex;
	flex: space-between;
	flex-grow: 1;
	flex-basis: 0;
}
#controlbuttons{
	grid-area: ctrlbtns;
	display: flex;
	flex: space-between;
}
#page-content{
	grid-area: content;
}
#footer{
	grid-area: footer;
}

.sub-btn-div{
	display: flex;
	flex-direction: row;
	flex: space-between;
	flex: 1;
}
.select-btn{
	flex: 1;
	margin: 0.25em 0.5em;
	border-radius: 0.5em;
}

.sub-nav-btn{
	width: 90%;
	margin: 0 auto;
	border-radius: 0.5em;
}

.nasa-display{
	height: 100%;
}
.nasa-img{
	width: 100%;
}
.daytime{
	background-color: #0276FD;
}
.nighttime{
	background-color: #003F87;
	color: whitesmoke;
}

@media only screen and (max-width: 600px) {
  .daytime{
	}
}


</style>


</head>
<body>
<div id="page-wrapper" class="daytime">
	<header id="header"><h1>Here's the header...</h1></header>
	<nav id="navbuttons">
		<div class="sub-btn-div"><button id="btn-weather" class="sub-nav-btn" type="button">Weather</button></div>
		<div class="sub-btn-div"><button id="btn-forecast" class="sub-nav-btn" type="button">Forecast</button></div>
		<div class="sub-btn-div"><button id="btn-nasa" class="sub-nav-btn" type="button">Daily NASA</button></div>
	</nav>
	<nav id="controlbuttons">
		<div id="units-btns" class="sub-btn-div">
			<button id="biu" class="button select-btn">Imperial Units</button>
			<button id="bmu" class="button select-btn">Metric Units</button>
		</div>
		<div id="temp-btns" class="sub-btn-div">
			<button id="bf" class="button select-btn">Fahrenheit</button>
			<button id="bc" class="button select-btn">Celcius</button>
		</div>
		<div id="time-btns" class="sub-btn-div">
			<button id="bst" class="button select-btn">12 Hour Clock</button>
			<button id="bmt" class="button select-btn">24 Hour Clock</button>
		</div>
	</nav>
	<div id="page-content"></div>
	<footer id="footer"><p>Footer...</p></footer>
</div>
</body>
<script type="application/javascript">
/* getLocalIP source: https://gist.github.com/hectorguo/672844c319547498dcb569df583f959d */
	//let ipstackAPIkey = "5562477e39162c7f951fbdf948701771";
	// nasa api key: WUvm5iyIw5AFJ0ahLwYb8Xm63WfkYiT9ChIbTu3A
	// timezonedb api key: G2MJ9GXGZCGH
	// holidayapi.com api-key: 46511983-44c2-4a93-a79c-41219c6e6919
	// holidayapi.com only allows last years holidays for free...
	// WebCal.fi
	/* ------- START PROMISE VERSION ------- */
	//function headerDisplay(currentHour)
	async function gather() {
	/* GETS IP ADDRESS https://ipinfo.io/developers */
	  let dataIP = await fetch("https://ipinfo.io/json");
	  dataIP = await dataIP.json();
	  console.log(dataIP);
	  let weatherData = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${dataIP["city"]},${dataIP["country"]}&id=524901&APPID=5d868cd94808acbf14ad297f46b257a7&lat=&units=imperial`);
	  weatherData = await weatherData.json();
		console.log('weatherdata:');
	  console.log(weatherData);
	  let forecastData = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${dataIP["city"]},${dataIP["country"]}&id=524901&APPID=5d868cd94808acbf14ad297f46b257a7&lat=&units=imperial`);
	  forecastData = await forecastData.json();
		console.log('forecastdata:');
	  console.log(forecastData);
		let sunrise = new Date(weatherData.sys.sunrise * 1000);
		console.log(`Sunrise - ${sunrise.getHours()}:${sunrise.getMinutes()}`);
	  let sunset = new Date(weatherData.sys.sunset * 1000);
	  console.log(`Sunset - ${sunset.getHours()}:${sunset.getMinutes()}`);
	  //let currentTime = new Date(weatherData.dt * 1000);
		function screenUpdater() {
			let currentTime = new Date();
			console.log(`Current Time - ${currentTime.getHours()}:${currentTime.getMinutes()}`);
			if (currentTime.getHours() >= sunset.getHours() && currentTime.getMinutes() >= sunset.getMinutes() || currentTime.getHours() <= sunrise.getHours() && currentTime.getMinutes() <= sunrise.getMinutes()) {
				document.getElementById("page-wrapper").className = "nighttime";
				document.getElementById("header").innerHTML = `<img class="header-img" src="/img/forecast/headernight.jpg"</img>`;
				console.log('its nighttime!');
			}
			else{
				document.getElementById("page-wrapper").className = "daytime";
				document.getElementById("header").innerHTML = `<img class="header-img" src="/img/forecast/headerday.jpg"</img>`;
				console.log('its daytime!');}
		}

	  console.log(`Coordinates: ${weatherData.coord.lat}, ${weatherData.coord.lon}`);
	  let timezone = await fetch(`http://api.timezonedb.com/v2.1/get-time-zone?key=G2MJ9GXGZCGH&format=json&by=position&lat=${weatherData.coord.lat}&lng=${weatherData.coord.lon}`);
	  timezone = await timezone.json();
	  console.log(timezone);

		// !!!!!!! HOLIDAY FINDER
		let holidayAPI = '3938dd10-e4dd-469f-a785-b127db51ef64';
		//let holiday = await fetch(`https://getfestivo.com/v1/holidays?api_key=${holidayAPI}&country=US&year=2019&month=7&day=04`)

		//holiday = await holiday.json();
	  //console.log(holiday);




	  /*
	  if (nasaMedia.media_type == "image"){
		document.getElementById('nasa').innerHTML = `<img src="${nasaMedia.url}">`;
	  }
	  else if (nasaMedia.media_type == "video"){
		  document.getElementById('nasa').innerHTML = `<iframe
														   width="560"
														   height="315"
														   src="${nasaMedia.url}?&autoplay=1"
														   frameborder="0"
														   allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
														   allowfullscreen>
													   </iframe>`;
	  }
	  */
	}
	gather();
	document.getElementById("btn-nasa").addEventListener("click", () => {
		console.log('clicked NASA button!');
		async function nasa () {
			let nasaMedia = await fetch(`https://api.nasa.gov/planetary/apod?api_key=WUvm5iyIw5AFJ0ahLwYb8Xm63WfkYiT9ChIbTu3A`);
			nasaMedia = await nasaMedia.json();
			console.log("NASA Data:");
			console.log(nasaMedia);
			let { copyright, explanation, media_type, url, date } = nasaMedia;
			document.getElementById("page-content").innerHTML = `
				<img class="nasa-img" src="${url}"</img>
				<p>Copyright: ${copyright}, ${date}</p>
				<p>${explanation}</p>
			`;
		}
		nasa();

	});
	 /* ------- end PROMISE VERSION ------- */
</script>
</html>
